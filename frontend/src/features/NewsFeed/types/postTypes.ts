// =============================================================================
// Базовые типы
// =============================================================================

/** Тип, представляющий временную метку в формате Unix. */
export type UnixTimestampType = number;

/**
 * Тип, представляющий идентификатор объекта в ВКонтакте (например,
 * ID пользователя, группы или поста).
 *
 * Всегда является числом.
 */
export type VKIDType = number;

/**
 * Тип, представляющий бинарный флаг, который может принимать только
 * два значения: `0` или `1`.
 *
 * Используется для логических признаков в API ВКонтакте.
 */
export type BinaryFlagType = 0 | 1;

// =============================================================================
// Вложения
// =============================================================================

/**
 * Интерфейс, описывающий размер изображения (фото).
 *
 * Содержит информацию о типе, URL и габаритах изображения.
 */
export interface IPhotoSize {
	/**
	 * Тип размера изображения (например, 's', 'm', 'x', 'y', 'z', 'w' и т.д.).
	 * Определяет категорию разрешения, назначенную ВКонтакте.
	 */
	type: string;

	/**
	 * URL изображения данного размера.
	 * Предназначен для прямой загрузки или отображения фото.
	 */
	url: string;

	/**
	 * Ширина изображения в пикселях.
	 */
	width: number;

	/**
	 * Высота изображения в пикселях.
	 */
	height: number;
}

/**
 * Интерфейс, описывающий фотографию из ВКонтакте.
 *
 * Содержит основные метаданные и информацию о размерах изображения.
 */
export interface IPhoto {
	/**
	 * Уникальный идентификатор фотографии.
	 */
	id: number;

	/**
	 * Идентификатор альбома, в котором находится фотография.
	 */
	album_id: number;

	/**
	 * Идентификатор владельца фотографии (пользователь или группа).
	 */
	owner_id: VKIDType;

	/**
	 * Идентификатор пользователя, загрузившего фотографию.
	 */
	user_id: VKIDType;

	/**
	 * Массив доступных размеров изображения.
	 * Содержит различные версии фото для адаптации под разные устройства
	 * и скорости интернета.
	 */
	sizes: IPhotoSize[];

	/**
	 * Описание (подпись) к фотографии. Может быть пустой строкой.
	 */
	text: string;

	/**
	 * Дата добавления фотографии, представленная в формате Unix-времени
	 * (секунды с 01.01.1970).
	 */
	date: UnixTimestampType;
}

/**
 * Интерфейс, описывающий изображение, связанное с видео (превью или постер).
 *
 * Используется в составе вложения "видео".
 */
export interface IVideoImage {
	/**
	 * URL изображения превью видео.
	 */
	url: string;

	/**
	 * Ширина изображения в пикселях.
	 */
	width: number;

	/**
	 * Высота изображения в пикселях.
	 */
	height: number;

	/**
	 * Флаг, указывающий, имеет ли изображение отступы (например, чёрные поля
	 * по краям). Поле необязательное, может отсутствовать в ответе API.
	 */
	with_padding?: number;
}

/**
 * Интерфейс, описывающий первый кадр видео (один из вариантов превью).
 * Видео может иметь несколько таких кадров разного размера.
 */
export interface IFirstFrame {
	/**
	 * URL изображения первого кадра видео.
	 */
	url: string;

	/**
	 * Ширина изображения кадра в пикселях.
	 */
	width: number;

	/**
	 * Высота изображения кадра в пикселях.
	 */
	height: number;
}

/**
 * Интерфейс, описывающий вложение типа "видео" из ВКонтакте.
 *
 * Содержит метаданные о видео файле: заголовок, продолжительность, просмотры
 * и т.д.
 */
export interface IVideoAttachment {
	/**
	 * Уникальный идентификатор видео.
	 */
	id: number;

	/**
	 * Идентификатор владельца видео (пользователь или группа).
	 */
	owner_id: VKIDType;

	/**
	 * Заголовок (название) видео.
	 */
	title: string;

	/**
	 * Продолжительность видео в секундах.
	 */
	duration: number;

	/**
	 * Описание видео, указанное пользователем.
	 */
	description: string;

	/**
	 * Дата публикации видео, в формате Unix-времени.
	 */
	date: UnixTimestampType;

	/**
	 * Количество комментариев к видео.
	 */
	comments: number;

	/**
	 * Количество просмотров видео.
	 */
	views: number;

	/**
	 * Ширина видео в пикселях.
	 */
	width: number;

	/**
	 * Высота видео в пикселях.
	 */
	height: number;

	/**
	 * Основное изображение-превью видео.
	 */
	image: IVideoImage;

	/**
	 * Флаг, указывающий, добавлено ли видео в избранное у текущего пользователя.
	 */
	is_favorite: boolean;

	/**
	 * Массив изображений первых кадров видео в разных разрешениях.
	 */
	first_frame: IFirstFrame[];

	/**
	 * Ключ доступа к видео.
	 *
	 * Требуется для работы с приватными или ограниченными видео.
	 */
	access_key: string;

	/**
	 * Флаг, указывающий, может ли текущий пользователь добавить это видео к себе.
	 *
	 * Принимает значение 0 или 1.
	 */
	can_add: BinaryFlagType;

	/**
	 * Служебный код трека, используемый ВКонтакте для аналитики.
	 */
	track_code: string;

	/**
	 * Тип видео (например, "video" или "music_video").
	 *
	 * Может использоваться для категоризации.
	 */
	type: string;
}

/**
 * Интерфейс, описывающий вложение типа "фото" с дополнительными полями,
 * специфичными для использования в постах (например, идентификатор записи).
 * Расширяет базовый интерфейс `IPhoto`.
 */
export interface IPhotoAttachment extends IPhoto {
	/**
	 * Идентификатор поста, в котором размещено фото.
	 */
	post_id: number;

	/**
	 * Ключ доступа к фото. Требуется для доступа к приватным изображениям.
	 */
	access_key: string;
}

/**
 * Интерфейс, описывающий вложение типа "ссылка" (предварительный просмотр URL).
 *
 * Отображает информацию о веб-странице, прикреплённой к посту.
 */
export interface ILinkAttachment {
	/**
	 * Полный URL ссылки.
	 */
	url: string;

	/**
	 * Заголовок страницы.
	 */
	title: string;

	/**
	 * Подпись (caption), часто используется как подзаголовок или домен сайта.
	 */
	caption: string;

	/**
	 * Описание содержимого страницы.
	 */
	description: string;

	/**
	 * Массив изображений-превью, связанных со ссылкой.
	 * Может содержать несколько размеров изображения.
	 */
	photo: IPhotoSize[];

	/**
	 * Флаг, указывающий, добавлена ли ссылка в избранное у текущего пользователя.
	 */
	is_favorite: boolean;
}

/**
 * Объединённый тип (union), представляющий возможные типы вложений в посте.
 *
 * Позволяет строго типизировать различные виды медиа-вложений.
 */
export type AttachmentType =
	| { type: "video"; video: IVideoAttachment }
	| { type: "photo"; photo: IPhotoAttachment }
	| { type: "link"; link: ILinkAttachment };

// =============================================================================
// Статистика
// =============================================================================

/**
 * Базовый интерфейс для статистики, содержащей числовое значение.
 *
 * Используется как родительский тип для различных метрик (лайки, комментарии
 * и т.д.).
 */
export interface IPostStatsCount {
	/**
	 * Числовое значение счётчика (например, количество лайков, комментариев
	 * и т.п.).
	 */
	count: number;
}

/**
 * Интерфейс, описывающий статистику по комментариям к посту.
 *
 * Расширяет базовый счётчик, добавляя флаги доступности действий.
 */
export interface ICommentsStats extends IPostStatsCount {
	/**
	 * Флаг, указывающий, может ли текущий пользователь оставить комментарий.
	 * Принимает значение 0 или 1.
	 */
	can_post: BinaryFlagType;

	/**
	 * Флаг, указывающий, могут ли сообщества (группы) оставлять комментарии.
	 */
	groups_can_post: boolean;
}

/**
 * Интерфейс, описывающий статистику по лайкам к посту.
 *
 * Содержит информацию о количестве лайков и возможных действиях пользователя.
 */
export interface ILikesStats extends IPostStatsCount {
	/**
	 * Флаг, указывающий, поставил ли текущий пользователь лайк.
	 * Принимает значение 0 или 1.
	 */
	user_likes: BinaryFlagType;

	/**
	 * Флаг, указывающий, может ли пользователь поставить лайк.
	 * Принимает значение 0 или 1.
	 */
	can_like: BinaryFlagType;

	/**
	 * Флаг, указывающий, может ли пользователь опубликовать лайк на своей
	 * странице (если лайк поставлен).
	 *
	 * Принимает значение 0 или 1.
	 */
	can_publish: BinaryFlagType;
}

/**
 * Интерфейс, описывающий статистику по репостам (распространению) поста.
 *
 * Содержит количество репостов и информацию о действиях пользователя.
 */
export interface IRepostsStats extends IPostStatsCount {
	/**
	 * Флаг, указывающий, сделал ли текущий пользователь репост.
	 * Принимает значение 0 или 1.
	 */
	user_reposted: BinaryFlagType;
}

/**
 * Тип, представляющий статистику просмотров поста.
 */
export type ViewsStatsType = IPostStatsCount;

/**
 * Интерфейс, объединяющий всю социальную статистику поста: комментарии, лайки,
 * репосты и просмотры.
 *
 * Используется для отображения и анализа вовлеченности аудитории.
 */
export interface ISocialStats {
	/**
	 * Статистика по комментариям.
	 */
	comments: ICommentsStats;

	/**
	 * Статистика по лайкам.
	 */
	likes: ILikesStats;

	/**
	 * Статистика по репостам.
	 */
	reposts: IRepostsStats;

	/**
	 * Статистика по просмотрам.
	 */
	views: ViewsStatsType;
}

// =============================================================================
// Основной пост
// =============================================================================

/**
 * Интерфейс, описывающий источник публикации поста.
 *
 * Указывает, откуда был опубликован пост (например, с сайта ВКонтакте, через
 * API, приложение и т.п.).
 */
export interface IPostSource {
	/**
	 * Тип источника публикации.
	 *
	 * Может принимать значение "vk" или другую строку (например, "api",
	 * "android", "iphone" и т.д.).
	 */
	type: "vk" | string;
}

/**
 * Интерфейс, описывающий пост из ВКонтакте.
 *
 * Содержит полную информацию о посте: текст, дату, автора, вложения
 * и социальную статистику.
 */
export interface IVKPost extends ISocialStats {
	/**
	 * Уникальный идентификатор поста.
	 */
	id: number;

	/**
	 * Идентификатор пользователя или сообщества, от имени которого был сделан
	 * пост.
	 */
	from_id: VKIDType;

	/**
	 * Идентификатор владельца стены, на которой опубликован пост.
	 *
	 * Может отличаться от `from_id` в случае репостов или публикаций в группах.
	 */
	owner_id: VKIDType;

	/**
	 * Дата публикации поста, представленная в формате Unix-времени
	 * (секунды с 01.01.1970).
	 */
	date: UnixTimestampType;

	/**
	 * Флаг, указывающий, помечен ли пост как реклама. Принимает значение 0 или 1.
	 */
	marked_as_ads: BinaryFlagType;

	/**
	 * Тип поста. Обычно имеет значение `"post"`, но может быть другим.
	 */
	post_type: "post" | string;

	/**
	 * Текст поста. Может быть пустой строкой, если пост содержит только вложения.
	 */
	text: string;

	/**
	 * Массив вложений к посту (фото, видео, ссылки и т.д.).
	 *
	 * Поле необязательное — может отсутствовать, если вложений нет.
	 */
	attachments?: AttachmentType[];

	/**
	 * Информация об источнике публикации поста.
	 */
	post_source: IPostSource;

	/**
	 * Флаг, указывающий, добавлен ли пост в избранное у текущего пользователя.
	 */
	is_favorite: boolean;
}

/**
 * Тип, представляющий массив постов ВКонтакте.
 */
export type VKPostsType = IVKPost[];

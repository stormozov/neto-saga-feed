import type { PayloadAction } from "@reduxjs/toolkit";
import type { VKPostsType } from "./postTypes";

// =============================================================================
// Типы состояния
// =============================================================================

/**
 * Интерфейс, описывающий состояние ленты новостей.
 * 
 * Содержит данные о постах, статусах загрузки, ошибках и наличии дополнительных 
 * данных.
 */
export interface INewsFeedState {
	/**
	 * Массив постов, полученных из ВКонтакте.
	 * Представляет список новостей, отображаемых в ленте.
	 */
	posts: VKPostsType;

	/**
	 * Флаг, указывающий, выполняется ли в данный момент загрузка данных.
	 * Используется для отображения индикатора загрузки.
	 */
	isLoading: boolean;

	/**
	 * Сообщение об ошибке, если произошла ошибка при загрузке данных.
	 * В случае успеха равно `null`.
	 */
	error: string | null;

	/**
	 * Флаг, указывающий, есть ли ещё посты для подгрузки.
	 * Используется для реализации пагинации или бесконечного скролла.
	 */
	hasMore: boolean;

	/**
	 * Флаг, указывающий, выполняется ли первоначальная загрузка данных.
	 * Может использоваться для отображения начального экрана загрузки.
	 */
	isInitialLoading: boolean;
}

// =============================================================================
// Типы экшенов
// =============================================================================

/**
 * Интерфейс, описывающий полезную нагрузку действия об успешной загрузке
 * новостей.
 */
export interface IPayloadActionSuccess {
	/**
	 * Массив полученных новостей, соответствующий типу данных VK.
	 */
	posts: VKPostsType;

	/**
	 * Признак, является ли загрузка первоначальной (первая страница).
	 * Используется для определения, нужно ли заменить весь список или добавить
	 * к существующему.
	 */
	isInitial: boolean;
}

/**
 * Тип действия: запрос на загрузку новостей (первой или следующей порции).
 *
 * Содержит `lastSeenId` — идентификатор последней просмотренной новости.
 * Если `undefined` — загружается начальная порция.
 */
export type FetchNewsAction = PayloadAction<number | undefined>;

/**
 * Тип действия: ошибка при загрузке новостей.
 *
 * Содержит строку с описанием ошибки.
 */
export type FetchNewsFailedAction = PayloadAction<string>;

/**
 * Тип действия: успешная загрузка новостей.
 *
 * Содержит массив новостей и флаг, указывающий, была ли загрузка начальной.
 */
export type FetchNewsSuccessAction = PayloadAction<IPayloadActionSuccess>;

/**
 * Тип действия: запрос на загрузку следующей порции новостей.
 *
 * В отличие от {@link FetchNewsAction}, гарантирует наличие `lastSeenId`
 * (не `undefined`).
 */
export type FetchMoreNewsAction = PayloadAction<number>;
